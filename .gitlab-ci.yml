# Note: We use --silent argument on npm invocations to keep the output simple
# and readable through email notifications.
image: node:6

cache:
    key: 'node-modules-kresus'
    paths:
        - node_modules/
        - yarn.lock

stages:
    - lint
    - build
    - test

lint:
    stage: lint
    before_script:
        - yarn install
    script:
        # Lint JS code
        - npm run --silent lint-full
        # And check banks and locales are correct
        - npm run --silent check

build:
    stage: build
    before_script:
        - yarn install
    script:
        # Check everything builds correctly
        - npm run --silent build-no-progress
    cache:
        policy: pull

test:
    stage: test
    before_script:
        - yarn install
    script:
        # Run the UI test suite
        - npm run --silent test
    cache:
        policy: pull

npm:
    stage: test
    before_script:
        - npm install --silent
    script:
        # Try to build with NPM installed deps
        - npm run --silent build-no-progress
    cache:
        key: "npm"
